<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Android.viewpagenavigation by nightynight</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Android.viewpagenavigation</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/nightynight/Android.ViewPageNavigation" class="btn">View on GitHub</a>
      <a href="https://github.com/nightynight/Android.ViewPageNavigation/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/nightynight/Android.ViewPageNavigation/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="使用viewpagerfragmentlistview模仿网易新闻客户端首页切换效果" class="anchor" href="#%E4%BD%BF%E7%94%A8viewpagerfragmentlistview%E6%A8%A1%E4%BB%BF%E7%BD%91%E6%98%93%E6%96%B0%E9%97%BB%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%A6%96%E9%A1%B5%E5%88%87%E6%8D%A2%E6%95%88%E6%9E%9C" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>使用ViewPager+Fragment+ListView模仿网易新闻客户端首页切换效果。</h3>

<h4>
<a id="先来看看activity_main布局文件" class="anchor" href="#%E5%85%88%E6%9D%A5%E7%9C%8B%E7%9C%8Bactivity_main%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>先来看看activity_main布局文件</h4>

<pre><code>&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent" &gt;
    &lt;LinearLayout
        android:id="@+id/head"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"&gt;
        &lt;!--Tab由HorizontalScrollView和RadioGroup实现--&gt;
        &lt;HorizontalScrollView
            android:id="@+id/channelScrollView"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_weight="4"
            android:scrollbars="none"&gt;
            &lt;RadioGroup
                android:id="@+id/channelRadioGroup"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:orientation="horizontal"&gt;
            &lt;/RadioGroup&gt;
        &lt;/HorizontalScrollView&gt;
        &lt;Button
            android:id="@+id/allCategory"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:textSize="10sp"
            android:layout_margin="0dp"
            android:text="所有分类"/&gt;
    &lt;/LinearLayout&gt;
    &lt;android.support.v4.view.ViewPager
        android:id="@+id/newsListViewPager"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:layout_below="@+id/head"
        android:layout_weight="1"&gt;
    &lt;/android.support.v4.view.ViewPager&gt;
    &lt;!--下面的LinearLayout用来放所有分类，默认是隐藏的--&gt;
    &lt;LinearLayout
        android:id="@+id/allCategoryLayout"
        android:layout_below="@+id/head"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="#ffffff"
        android:visibility="gone"&gt;
        &lt;!--所有分类由Button填充，用GridView实现--&gt;
        &lt;GridView xmlns:android="http://schemas.android.com/apk/res/android"
            android:id="@+id/gridview"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:columnWidth="90dp"
            android:numColumns="auto_fit"
            android:verticalSpacing="10dp"
            android:horizontalSpacing="10dp"
            android:stretchMode="columnWidth"
            android:gravity="center"&gt;
        &lt;/GridView&gt;
    &lt;/LinearLayout&gt;
&lt;/RelativeLayout&gt;
</code></pre>

<h4>
<a id="再来看看其他布局文件" class="anchor" href="#%E5%86%8D%E6%9D%A5%E7%9C%8B%E7%9C%8B%E5%85%B6%E4%BB%96%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>再来看看其他布局文件</h4>

<p>tab_rb.xml：定义RadioGroup中RadioButton怎么显示</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;RadioButton xmlns:android="http://schemas.android.com/apk/res/android"
                android:layout_width="wrap_content"
                android:layout_height="30dp"
                android:paddingLeft="15dp"
                android:background="@drawable/tab_selector"
                android:paddingRight="15dp"
                android:paddingTop="10dp"
                android:paddingBottom="10dp"
                android:button="@null" /&gt;
    &lt;!--android:background="@drawable/tab_selector"会读取tab_selector.xml文件，控制RadioButton的背景显示--&gt;
    &lt;!--android:button="@null"设置RadioButton前面的小圆圈不显示，只显示文字--&gt;
</code></pre>

<p>channelLayout.xml：定义每个分类下新闻列表怎么显示</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ListView xmlns:android="http://schemas.android.com/apk/res/android"
    android:id="@id/android:list"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:drawSelectorOnTop="true"
    android:scrollbars="vertical" /&gt;
</code></pre>

<p>news.xml：定义新闻列表中每条新闻怎么显示</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;TextView
        android:id="@+id/newsTitle"
        android:layout_width="match_parent"
        android:layout_height="30dp"
        android:textSize="20dp"
        android:paddingLeft="5dp" /&gt;
&lt;/LinearLayout&gt;
</code></pre>

<p>drawable/tab_selector.xml：控制导航的背景显示</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;selector xmlns:android="http://schemas.android.com/apk/res/android" &gt;
      &lt;item android:state_checked="true" &gt;&lt;!-- 选中状态 --&gt;
        &lt;layer-list &gt;
            &lt;item &gt;
                &lt;shape android:shape="rectangle"&gt;
                    &lt;stroke android:width="5dp"  android:color="#ff0000"/&gt;    
                &lt;/shape&gt;
            &lt;/item&gt;
            &lt;item  android:bottom="5dp" &gt;
                &lt;shape android:shape="rectangle" &gt;
                     &lt;solid android:color="#fff"/&gt;
                 &lt;/shape&gt;
            &lt;/item&gt;
        &lt;/layer-list&gt; 
    &lt;/item&gt;
    &lt;item &gt;&lt;!-- 默认状态 --&gt;
        &lt;shape &gt;
                &lt;solid  android:color="#FAFAFA"/&gt;
        &lt;/shape&gt;
    &lt;/item&gt;
&lt;/selector&gt;
</code></pre>

<p>news_details.xml：定义新闻详细页面的显示</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;TextView
        android:id="@+id/text"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content" /&gt;
&lt;/LinearLayout&gt;
</code></pre>

<h4>
<a id="然后来看看mainactivity先让mainactivity继承fragment类和onpagechangelistener接口" class="anchor" href="#%E7%84%B6%E5%90%8E%E6%9D%A5%E7%9C%8B%E7%9C%8Bmainactivity%E5%85%88%E8%AE%A9mainactivity%E7%BB%A7%E6%89%BFfragment%E7%B1%BB%E5%92%8Conpagechangelistener%E6%8E%A5%E5%8F%A3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>然后来看看MainActivity，先让MainActivity继承Fragment类和OnPageChangeListener接口</h4>

<pre><code>public class MainActivity extends FragmentActivity implements ViewPager.OnPageChangeListener  {
    HorizontalScrollView horizontalScrollView;
    RadioGroup radioGroup;
    ViewPager viewPager;
    List&lt;ChannelList&gt; channelLists;
    private List&lt;ListFragment&gt; fragmentList=new ArrayList&lt;ListFragment&gt;();
    private PageFragmentAdapter adapter=null;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Button allCategory=(Button)findViewById(R.id.allCategory);
        allCategory.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                //下面实现展开所有分类功能
                LinearLayout linearLayout=(LinearLayout)findViewById(R.id.allCategoryLayout);
                if (linearLayout.getVisibility()==View.VISIBLE){
                    linearLayout.setVisibility(View.INVISIBLE);
                }else{
                    linearLayout.setVisibility(View.VISIBLE);
                }
                //所有分类由GridView实现，里面由Button填充
                GridView gridview = (GridView) findViewById(R.id.gridview);
                ButtonAdapter adapter=new ButtonAdapter(MainActivity.this);
                gridview.setAdapter(adapter);
            }
        });
        horizontalScrollView=(HorizontalScrollView)findViewById(R.id.channelScrollView);
        radioGroup=(RadioGroup)findViewById(R.id.channelRadioGroup);
        viewPager=(ViewPager)findViewById(R.id.newsListViewPager);
        //点击radioGroup中的item后更新viewPager
        radioGroup.setOnCheckedChangeListener(new RadioGroup.OnCheckedChangeListener() {
            @Override
            public void onCheckedChanged(RadioGroup group, int checkedId) {
                viewPager.setCurrentItem(checkedId);
            }
        });
        //给ViewPager设置监听器，当viewPager滑动时会去执行onPageSelected中的函数
        viewPager.setOnPageChangeListener(this);
        initData();//获取数据
        initTab();//初始化Tab
        initViewPager();//初始化ViewPager
        radioGroup.check(0);//初始化显示第一个channel
    }
    //获取数据，实际情况是从数据库中获取
    public void initData(){
        channelLists=new ArrayList&lt;ChannelList&gt;();
        channelLists.add(new ChannelList("头条", Arrays.asList(new News[]{new News("头条一"),new News("头条二")})));
        channelLists.add(new ChannelList("娱乐", Arrays.asList(new News[]{new News("娱乐一"),new News("娱乐二")})));
        channelLists.add(new ChannelList("体育", Arrays.asList(new News[]{new News("体育一"),new News("体育二")})));
        channelLists.add(new ChannelList("财经", Arrays.asList(new News[]{new News("财经一"),new News("财经二")})));
        channelLists.add(new ChannelList("科技", Arrays.asList(new News[]{new News("科技一"),new News("科技二")})));
        channelLists.add(new ChannelList("汽车", Arrays.asList(new News[]{new News("汽车一"),new News("汽车二")})));
        channelLists.add(new ChannelList("时尚", Arrays.asList(new News[]{new News("时尚一"),new News("时尚二")})));
        channelLists.add(new ChannelList("社会", Arrays.asList(new News[]{new News("社会一"),new News("社会二")})));
        channelLists.add(new ChannelList("热点", Arrays.asList(new News[]{new News("热点一"),new News("热点二")})));
    }
    public void initTab(){
        for(int i=0;i&lt;channelLists.size();i++){
            RadioButton rb=(RadioButton) LayoutInflater.from(this).inflate(R.layout.tab_rb, null);
            rb.setId(i);
            rb.setText(channelLists.get(i).getChannelName());
            radioGroup.addView(rb);
        }
    }
    public void initViewPager(){
        for(int i=0;i&lt;channelLists.size();i++){
            ListFragment frag=new NewsFragment();
            Bundle bundle=new Bundle();
            //把每个channelList传给Fragment
            //bundle中可以放继承Serializable接口的类的实例
            bundle.putSerializable("channelList",channelLists.get(i));
            frag.setArguments(bundle);
            fragmentList.add(frag);
        }
        //把fragmentList放到viewPage中
        adapter=new PageFragmentAdapter(super.getSupportFragmentManager(),fragmentList);
        viewPager.setAdapter(adapter);
    }
    @Override
    public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) {
    }
    @Override
    public void onPageSelected(int position) {
        //当viewPager滑动时，更新上面的Tab目录状态
        updateScorllView(position);
    }
    @Override
    public void onPageScrollStateChanged(int state) {
    }
    public void updateScorllView(int position){
        RadioButton rb=(RadioButton)radioGroup.getChildAt(position);
        rb.setChecked(true);
        int left=rb.getLeft();
        int width=rb.getMeasuredWidth();
        DisplayMetrics metrics=new DisplayMetrics();
        super.getWindowManager().getDefaultDisplay().getMetrics(metrics);
        int screenWidth=metrics.widthPixels;
        int len=left+width/2-screenWidth/2;
        horizontalScrollView.smoothScrollTo(len, 0);//滑动ScroollView
    }
}
</code></pre>

<h4>
<a id="下面是两个实体类" class="anchor" href="#%E4%B8%8B%E9%9D%A2%E6%98%AF%E4%B8%A4%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%B1%BB" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>下面是两个实体类</h4>

<p>新闻类：</p>

<pre><code>public class News {
    String title;
    public News(String title) {
        this.title = title;
    }
    public News() {
    }
    public String getTitle() {
        return title;
    }
    @Override
    public String toString() {
        return "News{" +
                "title='" + title + '\'' +
                '}';
    }
    public void setTitle(String title) {
        this.title = title;
    }
}
</code></pre>

<p>导航分类类；有两个属性——导航分类的名字和新闻列表（放该导航下的所有新闻），实现了Serializable接口，为了可以让该对象可以被加到Bundle中被传递</p>

<pre><code>public class ChannelList implements Serializable {
    String channelName;
    List&lt;News&gt; newsList;
    public String getChannelName() {
        return channelName;
    }
    public void setChannelName(String channelName) {
        this.channelName = channelName;
    }
    public List&lt;News&gt; getNewsList() {
        return newsList;
    }
    public void setNewsList(List&lt;News&gt; newsList) {
        this.newsList = newsList;
    }
    public ChannelList(String channelName, List&lt;News&gt; newsList) {
        this.channelName = channelName;
        this.newsList = newsList;
    }
}
</code></pre>

<h4>
<a id="再来看看fragment类用来向viewpager中添加fragment" class="anchor" href="#%E5%86%8D%E6%9D%A5%E7%9C%8B%E7%9C%8Bfragment%E7%B1%BB%E7%94%A8%E6%9D%A5%E5%90%91viewpager%E4%B8%AD%E6%B7%BB%E5%8A%A0fragment" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>再来看看Fragment类，用来向ViewPager中添加fragment</h4>

<pre><code>public class NewsFragment extends ListFragment {
    private ChannelList channelList;
    private View view;
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        if(view==null){//优化View减少View的创建次数
                        //在每个Fragment中显示的内容
            ListView listView=(ListView)LayoutInflater.from(getActivity()).inflate(R.layout.channel_layout,null);
            ArrayList&lt;HashMap&lt;String, String&gt;&gt; list = new ArrayList&lt;HashMap&lt;String, String&gt;&gt;();
            HashMap&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();
            //把每个分类下的新闻标题放到list中
            for (int i=0;i&lt;channelList.getNewsList().size();i++){
                map.put("news_title", channelList.getNewsList().get(i).getTitle());
                list.add(map);
                map=new HashMap&lt;String, String&gt;();
            }
            SimpleAdapter listAdapter = new SimpleAdapter(getActivity(), list,
                    R.layout.news, new String[] { "news_title"},
                    new int[] { R.id.newsTitle});
            setListAdapter(listAdapter);
            //View中的setTag（Object）表示给View添加一个格外的数据，以后可以用getTag()将这个数据取出来。
            listView.setTag(channelList);
            //设置fragment中的内容
            view=listView;
        }
        ViewGroup parent=(ViewGroup)view.getParent();
        if(parent!=null){//如果View已经添加到容器中，要进行删除，否则会报错
            parent.removeView(view);
        }
        return view;
    }
    @Override
    public void setArguments(Bundle bundle) {
        // TODO Auto-generated method stub
        channelList=(ChannelList)bundle.getSerializable("channelList");
    }
    @Override
    public void onListItemClick(ListView l, View v, int position, long id) {
        // TODO Auto-generated method stub
        super.onListItemClick(l, v, position, id);
        //当点击某条新闻标题时，跳转到新闻详细页面，传入分类名和新闻的Title
        Intent intent=new Intent(getActivity(), NewsDetails.class);
        intent.putExtra("channelName",((ChannelList)(l.getTag())).getChannelName());
        intent.putExtra("newsTitle",((ChannelList)l.getTag()).getNewsList().get(position).getTitle());
        startActivity(intent);
    }
}
</code></pre>

<h4>
<a id="接下来看两个adapter" class="anchor" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9C%8B%E4%B8%A4%E4%B8%AAadapter" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>接下来看两个adapter</h4>

<p>PageFragmentAdapter——用来给Fragment添加内容，向ViewPager中添加fragment需要FragmentPagerAdapter，但它是个抽象类，所以需要有各类来继承它，这就取名PageFragmentAdapter</p>

<pre><code>public class PageFragmentAdapter extends FragmentPagerAdapter {
    private List&lt;ListFragment&gt; fragmentList;
    private FragmentManager fm;
    public PageFragmentAdapter(FragmentManager fm, List&lt;ListFragment&gt; fragmentList) {
        super(fm);
        // TODO Auto-generated constructor stub
        this.fragmentList=fragmentList;
        this.fm=fm;
    }
    @Override
    public Fragment getItem(int idx) {
        // TODO Auto-generated method stub
        return (Fragment)(fragmentList.get(idx%fragmentList.size()));
    }
    @Override
    public int getCount() {
        // TODO Auto-generated method stub
        return fragmentList.size();
    }
    @Override  
    public int getItemPosition(Object object) {  
       return POSITION_NONE;//没有找到child要求重新加载
    }
}
</code></pre>

<p>ButtonAdapter——该Adapter用来向所有分类中添加Button</p>

<pre><code>public class ButtonAdapter extends BaseAdapter {
    private Activity activity;
    public ButtonAdapter(Activity c) {
        activity = c;
    }
    public int getCount() {
        return Buttons.length;
    }
    public Object getItem(int position) {
        return null;
    }
    public long getItemId(int position) {
        return position;
    }
    // create a new ImageView for each item referenced by the Adapter
    public View getView(final int position, View convertView, ViewGroup parent) {
        Button button;
        if (convertView == null) {  // if it's not recycled, initialize some attributes
            button = new Button(activity);
        } else {
            button = (Button) convertView;
        }
        button.setText(Buttons[position]);
        button.setId(position);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                ViewPager viewPager=(ViewPager)activity.findViewById(R.id.newsListViewPager);
                viewPager.setCurrentItem(position);
                LinearLayout linearLayout=(LinearLayout)activity.findViewById(R.id.allCategoryLayout);
                linearLayout.setVisibility(View.INVISIBLE);
            }
        });
        return button;
    }
    // references to our images
    private String[] Buttons = {
            "头条","娱乐","体育","财经","科技","汽车","时尚","社会","热点"
    };
}
</code></pre>

<h4>
<a id="最后还有一个newsdetailsactivity用来显示新闻的详细信息需要加到manifest中" class="anchor" href="#%E6%9C%80%E5%90%8E%E8%BF%98%E6%9C%89%E4%B8%80%E4%B8%AAnewsdetailsactivity%E7%94%A8%E6%9D%A5%E6%98%BE%E7%A4%BA%E6%96%B0%E9%97%BB%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%E9%9C%80%E8%A6%81%E5%8A%A0%E5%88%B0manifest%E4%B8%AD" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>最后，还有一个NewsDetailsActivity——用来显示新闻的详细信息，需要加到manifest中</h4>

<pre><code>public class NewsDetailsActivity extends Activity {
    private TextView textView;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.news_details);
        Intent intent=getIntent();
        String channelName=intent.getStringExtra("channelName");
        String newsTitle=intent.getStringExtra("newsTitle");
        textView=(TextView)findViewById(R.id.text);
        textView.setText("分类："+channelName+" 新闻："+newsTitle);
    }
}
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/nightynight/Android.ViewPageNavigation">Android.viewpagenavigation</a> is maintained by <a href="https://github.com/nightynight">nightynight</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
